<mxfile host="app.diagrams.net" modified="2024-05-28T11:08:42.914Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36" etag="Iu1iikXNmCDPbnMhDn0U" version="24.4.9" type="github">
  <diagram name="第 1 页" id="PkiXDes5N5bRzUGDbgQO">
    <mxGraphModel dx="2238" dy="749" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Z7uTY06q8HQg-axiRB6t-1" value="单机" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffff88;strokeColor=none;horizontal=1;align=center;verticalAlign=middle;size=18;" parent="1" vertex="1">
          <mxGeometry x="50" y="40" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-2" value="producer" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="150" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-3" value="kafka - broker - jvm" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="200" y="95" width="420" height="165" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-4" value="partition 0" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="240" y="145" width="330" height="65" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-35" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;strokeColor=#FF0000;" parent="1" source="Z7uTY06q8HQg-axiRB6t-5" target="Z7uTY06q8HQg-axiRB6t-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-5" value="cusumer" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="700" y="150" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-7" value="kernel" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="250" y="310" width="320" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-8" value="1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="200" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-9" value="2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="292" y="200" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-10" value="3" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="342" y="200" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-11" value="4" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="392" y="200" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=none;dashed=1;" parent="1" source="Z7uTY06q8HQg-axiRB6t-12" target="Z7uTY06q8HQg-axiRB6t-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-18" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" parent="1" source="Z7uTY06q8HQg-axiRB6t-12" target="Z7uTY06q8HQg-axiRB6t-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-33" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;strokeColor=#FF0000;" parent="1" source="Z7uTY06q8HQg-axiRB6t-12" target="Z7uTY06q8HQg-axiRB6t-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-12" value="pagecache" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="250" y="324" width="113" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="1" source="Z7uTY06q8HQg-axiRB6t-2" target="Z7uTY06q8HQg-axiRB6t-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-15" value="磁盘&lt;div&gt;文件方式保存数据&lt;/div&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="217" y="440" width="400" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-17" value="写磁盘就会有个粒度，写的粒度越小，速度越慢&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;trade off&lt;/div&gt;&lt;div&gt;我们应该把单机的持久化可靠性转向集群多机方式&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffff88;strokeColor=none;horizontal=1;align=left;verticalAlign=top;size=18;" parent="1" vertex="1">
          <mxGeometry x="90" y="310" width="140" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-19" value="data" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="217" y="490" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-24" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="220" y="520" width="139" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-20" value="1" style="ellipse;whiteSpace=wrap;html=1;" parent="Z7uTY06q8HQg-axiRB6t-24" vertex="1">
          <mxGeometry width="34.92462311557789" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-21" value="2" style="ellipse;whiteSpace=wrap;html=1;" parent="Z7uTY06q8HQg-axiRB6t-24" vertex="1">
          <mxGeometry x="36.321608040201006" width="34.92462311557789" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-22" value="3" style="ellipse;whiteSpace=wrap;html=1;" parent="Z7uTY06q8HQg-axiRB6t-24" vertex="1">
          <mxGeometry x="71.2462311557789" width="34.92462311557789" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-23" value="4" style="ellipse;whiteSpace=wrap;html=1;" parent="Z7uTY06q8HQg-axiRB6t-24" vertex="1">
          <mxGeometry x="106.17085427135679" width="32.82914572864322" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Z7uTY06q8HQg-axiRB6t-25" target="Z7uTY06q8HQg-axiRB6t-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-25" value="index&lt;div&gt;offset&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="430" y="490" width="75" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Z7uTY06q8HQg-axiRB6t-27" target="Z7uTY06q8HQg-axiRB6t-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-27" value="index&lt;div&gt;timestamp&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="546" y="490" width="75" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=1;entryDx=0;entryDy=0;exitX=0.75;exitY=1;exitDx=0;exitDy=0;strokeColor=#FF0000;strokeWidth=1;" parent="1" source="Z7uTY06q8HQg-axiRB6t-32" target="Z7uTY06q8HQg-axiRB6t-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="405.86" as="sourcePoint" />
            <mxPoint x="794.3553390593274" y="235.00213562373096" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-32" value="sendfile(in,offset.out)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="431" y="326" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-14" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Z7uTY06q8HQg-axiRB6t-3" target="Z7uTY06q8HQg-axiRB6t-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-36" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#FF0000;" parent="1" source="Z7uTY06q8HQg-axiRB6t-3" target="Z7uTY06q8HQg-axiRB6t-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-37" value="注意零拷贝不经过用户空间，但是必须保证pagecache里面有，没有的话，需要进行构建" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffff88;strokeColor=none;horizontal=1;align=left;verticalAlign=top;size=18;" parent="1" vertex="1">
          <mxGeometry x="570" y="260" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-42" value="分区可靠性，要解决一个问题，伴随着引入更多的问题" style="shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.33855612618582587;arrowSize=0.11218369646770199;" parent="1" vertex="1">
          <mxGeometry y="560" width="820" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-43" value="producer" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-20" y="925" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-44" value="kafka - broker - jvm" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=top;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="201" y="700" width="420" height="145" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-45" value="partition 0 leader" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="241" y="740" width="330" height="55" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-46" value="1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="241" y="785" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-47" value="2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="293" y="785" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-48" value="3" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="343" y="785" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-49" value="4" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="393" y="785" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-50" value="分布式集群" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffff88;strokeColor=none;horizontal=1;align=center;verticalAlign=top;size=18;" parent="1" vertex="1">
          <mxGeometry x="30" y="640" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-51" value="kafka不是一个读写分离的组件，所以prducer只能向分区的leader进行发送消息&lt;div&gt;consumer只能向分区拉取数据&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="166" y="620" width="510" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-52" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Z7uTY06q8HQg-axiRB6t-43" target="Z7uTY06q8HQg-axiRB6t-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-53" value="kafka - broker - jvm" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=top;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="201" y="870" width="420" height="145" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-54" value="partition 0 follower" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="241" y="910" width="330" height="55" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-55" value="1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="241" y="955" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-56" value="2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="293" y="955" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-57" value="3" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="343" y="955" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-58" value="4" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="393" y="955" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-59" value="kafka - broker - jvm" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=top;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="200" y="1050" width="420" height="145" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-60" value="partition 0 follower" style="rounded=0;whiteSpace=wrap;html=1;align=center;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="240" y="1090" width="330" height="55" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-61" value="1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="1135" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-62" value="2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="292" y="1135" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-63" value="3" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="342" y="1135" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-64" value="4" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="392" y="1135" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-65" value="cusumer" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="700" y="915" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-66" value="一致性&lt;div style=&quot;font-size: 14px;&quot;&gt;1. 强一致性，所有节点必须全部存活，&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;一致性破坏了可用性&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;2-1. 最终一致性，过半通过，最常用的分布式一致性解决方案&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;2-2. ISR(in sync replicas) 连通性&amp;amp;活跃性&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;OSR(outof-sync replicas),超过阈值时间，没有心跳&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;AR(Assigned) 面向分区的副本集合，创建topic的时候你给出了分区的副本数，那么controller在创建时候就已经分配了brocker和分区的对应关系，并且得到了该分区的brocker集合&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;AR = ISR + OSR&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;ack = -1&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffff88;strokeColor=none;horizontal=1;align=left;verticalAlign=top;size=18;fontStyle=1;fontSize=14;" parent="1" vertex="1">
          <mxGeometry y="1220" width="460" height="180" as="geometry" />
        </mxCell>
        <mxCell id="Z7uTY06q8HQg-axiRB6t-67" value="ack&amp;nbsp;&lt;div&gt;1 默认值，只需要leader写入pagecache就可以&lt;/div&gt;&lt;div&gt;-1 最严苛 所有的ISR副本都要同步，一致&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffe6cc;strokeColor=#d79b00;horizontal=1;align=left;verticalAlign=top;size=18;" parent="1" vertex="1">
          <mxGeometry x="-30" y="715" width="220" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
